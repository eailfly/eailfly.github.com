
<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="/theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/solid.css">


    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Hello, World! Atom">





<meta name="author" content="EaiLFly" />
<meta name="description" content="树莓派断网后不会自动重连Wifi，网上找到了解决方案 repo在这里：https://github.com/dweeber/WiFi_Check 把脚本放到/usr/local/bin/wifi_check，然后编辑/etc/crontab： */5 * * * * root /usr/local/bin/wifi_check 脚本内容: #!/bin/bash ################################################################## # A Project of TNET Services, Inc # # Title: WiFi_Check # Author: Kevin Reed (Dweeber) # dweeber.dweebs@gmail.com # Project: Raspberry Pi Stuff # # Copyright: Copyright (c) 2012 Kevin …" />
<meta name="keywords" content="">


<meta property="og:site_name" content="Hello, World!"/>
<meta property="og:title" content="树莓派自动重连WiFi"/>
<meta property="og:description" content="树莓派断网后不会自动重连Wifi，网上找到了解决方案 repo在这里：https://github.com/dweeber/WiFi_Check 把脚本放到/usr/local/bin/wifi_check，然后编辑/etc/crontab： */5 * * * * root /usr/local/bin/wifi_check 脚本内容: #!/bin/bash ################################################################## # A Project of TNET Services, Inc # # Title: WiFi_Check # Author: Kevin Reed (Dweeber) # dweeber.dweebs@gmail.com # Project: Raspberry Pi Stuff # # Copyright: Copyright (c) 2012 Kevin …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/shu-mei-pai-zi-dong-zhong-lian-wifi.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-07-13 11:14:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/eailfly.html">
<meta property="article:section" content="misc"/>
<meta property="og:image" content="">

  <title>Hello, World! &ndash; 树莓派自动重连WiFi</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="">
        <img src="/theme/img/profile.png" alt="" title="">
      </a>

      <h1>
        <a href=""></a>
      </h1>



      <nav>
        <ul class="list">



            <li>
              <a target="_self" href="http://getpelican.com/" >Pelican</a>
            </li>
            <li>
              <a target="_self" href="http://python.org/" >Python.org</a>
            </li>
            <li>
              <a target="_self" href="http://jinja.pocoo.org/" >Jinja2</a>
            </li>
            <li>
              <a target="_self" href="#" >You can modify those links in your config file</a>
            </li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-You can add links in your config file" href="#" target="_blank">
              <i class="fab fa-You can add links in your config file"></i>
            </a>
          </li>
          <li>
            <a  class="sc-Another social link" href="#" target="_blank">
              <i class="fab fa-Another social link"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="shu-mei-pai-zi-dong-zhong-lian-wifi">树莓派自动重连WiFi</h1>
    <p>
      Posted on Mon 13 July 2020 in <a href="/category/misc.html">misc</a>

    </p>
  </header>


  <div>
    <p>树莓派断网后不会自动重连Wifi，网上找到了解决方案</p>
<p>repo在这里：<a href="https://github.com/dweeber/WiFi_Check">https://github.com/dweeber/WiFi_Check</a></p>
<p>把脚本放到<code>/usr/local/bin/wifi_check</code>，然后编辑<code>/etc/crontab</code>：</p>
<div class="highlight"><pre><span></span><span class="err">*/5 * * * * root /usr/local/bin/wifi_check</span>
</pre></div>


<p>脚本内容:</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">##################################################################</span>
<span class="c1"># A Project of TNET Services, Inc</span>
<span class="c1">#</span>
<span class="c1"># Title:     WiFi_Check</span>
<span class="c1"># Author:    Kevin Reed (Dweeber)</span>
<span class="c1">#            dweeber.dweebs@gmail.com</span>
<span class="c1"># Project:   Raspberry Pi Stuff</span>
<span class="c1">#</span>
<span class="c1"># Copyright: Copyright (c) 2012 Kevin Reed &lt;kreed@tnet.com&gt;</span>
<span class="c1">#            https://github.com/dweeber/WiFi_Check</span>
<span class="c1">#</span>
<span class="c1"># Purpose:</span>
<span class="c1">#</span>
<span class="c1"># Script checks to see if WiFi has a network IP and if not</span>
<span class="c1"># restart WiFi</span>
<span class="c1">#</span>
<span class="c1"># Uses a lock file which prevents the script from running more</span>
<span class="c1"># than one at a time.  If lockfile is old, it removes it</span>
<span class="c1">#</span>
<span class="c1"># Instructions:</span>
<span class="c1">#</span>
<span class="c1"># o Install where you want to run it from like /usr/local/bin</span>
<span class="c1"># o chmod 0755 /usr/local/bin/WiFi_Check</span>
<span class="c1"># o Add to crontab</span>
<span class="c1">#</span>
<span class="c1"># Run Every 5 mins - Seems like ever min is over kill unless</span>
<span class="c1"># this is a very common problem.  If once a min change */5 to *</span>
<span class="c1"># once every 2 mins */5 to */2 ... </span>
<span class="c1">#</span>
<span class="c1"># */5 * * * * /usr/local/bin/WiFi_Check </span>
<span class="c1">#</span>
<span class="c1">##################################################################</span>
<span class="c1"># Settings</span>
<span class="c1"># Where and what you want to call the Lockfile</span>
<span class="nv">lockfile</span><span class="o">=</span><span class="s1">&#39;/var/run/WiFi_Check.pid&#39;</span>
<span class="c1"># Which Interface do you want to check/fix</span>
<span class="nv">wlan</span><span class="o">=</span><span class="s1">&#39;wlan0&#39;</span>
<span class="c1">##################################################################</span>
<span class="nb">echo</span>
<span class="nb">echo</span> <span class="s2">&quot;Starting WiFi check for </span><span class="nv">$wlan</span><span class="s2">&quot;</span>
date
<span class="nb">echo</span> 

<span class="c1"># Check to see if there is a lock file</span>
<span class="k">if</span> <span class="o">[</span> -e <span class="nv">$lockfile</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c1"># A lockfile exists... Lets check to see if it is still valid</span>
    <span class="nv">pid</span><span class="o">=</span><span class="sb">`</span>cat <span class="nv">$lockfile</span><span class="sb">`</span>
    <span class="k">if</span> <span class="nb">kill</span> -0 <span class="p">&amp;</span>&gt;1 &gt; /dev/null <span class="nv">$pid</span><span class="p">;</span> <span class="k">then</span>
        <span class="c1"># Still Valid... lets let it be...</span>
        <span class="c1">#echo &quot;Process still running, Lockfile valid&quot;</span>
        <span class="nb">exit</span> <span class="m">1</span>
    <span class="k">else</span>
        <span class="c1"># Old Lockfile, Remove it</span>
        <span class="c1">#echo &quot;Old lockfile, Removing Lockfile&quot;</span>
        rm <span class="nv">$lockfile</span>
    <span class="k">fi</span>
<span class="k">fi</span>
<span class="c1"># If we get here, set a lock file using our current PID#</span>
<span class="c1">#echo &quot;Setting Lockfile&quot;</span>
<span class="nb">echo</span> <span class="nv">$$</span> &gt; <span class="nv">$lockfile</span>

<span class="c1"># We can perform check</span>
<span class="nb">echo</span> <span class="s2">&quot;Performing Network check for </span><span class="nv">$wlan</span><span class="s2">&quot;</span>
<span class="k">if</span> ip a show <span class="nv">$wlan</span> <span class="p">|</span> grep -q <span class="s2">&quot;inet ((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}&quot;</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;Network is Okay&quot;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;Network connection down! Attempting reconnection.&quot;</span>
    ip link <span class="nb">set</span> <span class="nv">$wlan</span> down
    sleep <span class="m">5</span>
    ip link <span class="nb">set</span> <span class="nv">$wlan</span> up
    ip a show <span class="nv">$wlan</span> <span class="p">|</span> grep <span class="s2">&quot;inet ((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}&quot;</span>
<span class="k">fi</span>

<span class="nb">echo</span> 
<span class="nb">echo</span> <span class="s2">&quot;Current Setting:&quot;</span>
ip a show <span class="nv">$wlan</span> <span class="p">|</span> grep <span class="s2">&quot;inet ((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}&quot;</span>
<span class="nb">echo</span>

<span class="c1"># Check is complete, Remove Lock file and exit</span>
<span class="c1">#echo &quot;process is complete, removing lockfile&quot;</span>
rm <span class="nv">$lockfile</span>
<span class="nb">exit</span> <span class="m">0</span>

<span class="c1">##################################################################</span>
<span class="c1"># End of Script</span>
<span class="c1">##################################################################</span>
</pre></div>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>





</article>

    <footer>
<p>&copy;  </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Hello, World! ",
  "url" : "",
  "image": "",
  "description": ""
}
</script>


</body>
</html>